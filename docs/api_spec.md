# Meowmory API 规格说明

Base URL: /api/v1  
认证方式：Bearer Token（未来版本） / 匿名访问（MVP 阶段）

---

## 1. 通用约定（Common Conventions）

### 1.1 请求格式
- 所有请求与响应均使用 `application/json`
- 请求体采用 UTF-8 编码

### 1.2 时间格式
- 所有时间字段使用 **ISO 8601** 格式  
  示例：
```json
  "created_at": "2025-12-21T17:35:30Z"
```

### 1.3 分页约定（如适用）

查询类接口支持以下参数：

| 参数名    | 类型  | 默认值 | 说明   |
| ------ | --- | --- | ---- |
| limit  | int | 20  | 返回条数 |
| offset | int | 0   | 偏移量  |


### 1.4 错误响应格式

统一错误返回结构如下：
{
  "error": {
    "code": "INVALID_REQUEST",
    "message": "word_text 不能为空"
  }
}
常见错误码示例：

| 错误码             | 含义      |
| --------------- | ------- |
| INVALID_REQUEST | 请求参数错误  |
| INVALID_INPUT   | 输入数据不合法 |
| UNAUTHORIZED    | 未认证或无权限 |
| NOT_FOUND       | 资源不存在   |
| INTERNAL_ERROR  | 服务器内部错误 |



## 2. 单词（Word）相关接口
### 2.1 导入单词
（用户上传csv文件或者提交表单，里面有某种语言（用户登陆之后选定的要学习的语言）标签，储存到数据库里面
POST /words
需要登录

+ csv
multipart/form-data

请求体
| 名称       | 类型     | 必填 | 说明                  |
| -------- | ------ | -- | ------------------- |
| file     | CSV 文件 | 是  | UTF-8，必须包含 `word` 列 |
| language | string | 否  | 默认使用用户学习语言          |


+ json
请求体
{
  "language": "sv",
  "words": ["hus", "vatten", "bok"]
}


响应
{
  "inserted": 3,
  "skipped": 1,
  "total": 4
}
{
  "error": "INVALID_INPUT"
}
{
  "error": "UNAUTHORIZED"
}

错误示例:
{
  "error": {
    "code": "INVALID_INPUT",
    "message": "CSV 文件为空"
  }
}
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Authentication required"
  }
}

处理规则

单词统一转换为小写

同一用户 + 同一语言下：

    已存在的单词将被跳过

    空值或非法行忽略

整个导入过程在 单一事务 中完成

不允许部分失败提交

数据来源：

user

word

## 3. 故事（Story）相关接口
## 3.1 生成故事

POST /stories/generate

请求体
{
  "lang": "en",
  "words": ["water", "book"],
  "wordcount":2
  "difficulty":"B1",
  "style": "romantic",
  "startwith":"Once upon a time, there is a princess..."
}

| 字段         | 类型       | 必填 | 说明              |
| ---------- | -------- | -- | --------------- |
| language   | string   | 是  | 故事语言            |
| words      | string[] | 是  | 必须包含的单词列表       |
| word_count | int      | 否  | 目标词数            |
| difficulty | string   | 否  | 难度等级（如 A2 / B1） |
| style      | string   | 否  | 文体风格            |
| start_with | string   | 否  | 指定开头文本          |

响应
{
  "story_id": "10",
  "user_id": "anonymous",
  "language": "en",
  "content": "A short story generated by the system...",
  "word_count": 10,
  "created_at": "2025-12-21T17:35:30Z"
}
数据来源：

user

story

story_word
## 3.2查找故事
查看当前用户历史生成的故事。

GET /stories

需要登录（MVP 阶段为匿名用户）

Query 参数

| 名称       | 类型     | 必填 | 说明    |
| -------- | ------ | -- | ----- |
| language | string | 否  | 按语言过滤 |
| limit    | int    | 否  | 默认 20 |
| offset   | int    | 否  | 默认 0  |

响应
```json
{
  "items": [
    {
      "story_id": 1,
      "language": "en",
      "content": "There...",
      "created_at": "2025-12-21T17:30:10Z"
    },
    {
      "story_id": 2,
      "language": "en",
      "content": "There...",
      "created_at": "2025-12-21T17:32:10Z"
    }
  ],
  "limit": 20,
  "offset": 0,
  "total": 2
}
```


## 4. 用户（User）相关接口（预留）

MVP 阶段支持匿名用户

后续版本将支持：

    用户注册

    登录

    Token 鉴权

user_id 永远由系统上下文推断，不允许客户端显式传入

## 5. 版本与扩展说明

当前版本：v1

API 保持向后兼容

新功能通过新增 endpoint 或字段实现